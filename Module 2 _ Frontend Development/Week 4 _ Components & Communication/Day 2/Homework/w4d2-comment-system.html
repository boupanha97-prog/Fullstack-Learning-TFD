<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Comment System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down {
            animation: fadeInDown 0.2s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-gray-800">
    <div id="app" class="p-4 md:p-8">
        <div class="max-w-3xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-t-xl shadow-sm p-6 border-b border-gray-100">
                <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                    <span>ðŸ’¬</span> Comment System
                    <span class="text-sm font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded-full ml-2">
                        {{ totalComments }} comments
                    </span>
                </h1>
            </div>

            <!-- Main Input Area -->
            <div class="bg-white shadow-sm p-6 mb-6 rounded-b-xl">
                <comment-input 
                    placeholder="What are your thoughts?" 
                    button-text="Post Comment"
                    @submit="addTopLevelComment">
                </comment-input>
            </div>

            <!-- Comments List -->
            <div class="space-y-4">
                <comment-card
                    v-for="comment in comments"
                    :key="comment.id"
                    :comment="comment"
                    @like="handleLike"
                    @reply="handleReply"
                    @delete="handleDelete"
                ></comment-card>
                
                <div v-if="comments.length === 0" class="text-center py-10 text-gray-500 bg-white rounded-xl shadow-sm">
                    <p class="text-lg">No comments yet.</p>
                    <p class="text-sm">Be the first to share your thoughts!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const app = createApp({
            data() {
                return {
                    // Sample data structure
                    comments: [
                        {
                            id: 1,
                            author: 'John Doe',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=John',
                            text: 'This is an amazing feature! Love it! The nested replies work perfectly.',
                            likes: 5,
                            liked: false,
                            timestamp: '2 hours ago',
                            replies: [
                                {
                                    id: 2,
                                    author: 'Jane Smith',
                                    avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jane',
                                    text: 'I totally agree with you! It makes discussions so much easier to follow.',
                                    likes: 2,
                                    liked: true,
                                    timestamp: '1 hour ago',
                                    replies: []
                                }
                            ]
                        },
                        {
                            id: 3,
                            author: 'Mike Johnson',
                            avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mike',
                            text: 'Great work on this! The UI is very clean.',
                            likes: 3,
                            liked: false,
                            timestamp: '5 hours ago',
                            replies: []
                        }
                    ],
                    nextId: 4,
                    currentUser: 'Current User'
                }
            },
            computed: {
                totalComments() {
                    const countRecursive = (list) => {
                        let count = list.length;
                        list.forEach(c => {
                            count += countRecursive(c.replies);
                        });
                        return count;
                    };
                    return countRecursive(this.comments);
                }
            },
            methods: {
                addTopLevelComment(text) {
                    this.comments.unshift({
                        id: this.nextId++,
                        author: this.currentUser,
                        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${this.nextId}`,
                        text: text,
                        likes: 0,
                        liked: false,
                        timestamp: 'Just now',
                        replies: []
                    });
                },
                handleLike(commentId) {
                    const comment = this.findComment(this.comments, commentId);
                    if (comment) {
                        comment.liked = !comment.liked;
                        comment.likes += comment.liked ? 1 : -1;
                    }
                },
                handleReply(commentId, text) {
                    const comment = this.findComment(this.comments, commentId);
                    if (comment) {
                        comment.replies.push({
                            id: this.nextId++,
                            author: this.currentUser,
                            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${this.nextId}`,
                            text: text,
                            likes: 0,
                            liked: false,
                            timestamp: 'Just now',
                            replies: []
                        });
                    }
                },
                handleDelete(commentId) {
                    if (confirm('Are you sure you want to delete this comment?')) {
                        this.deleteCommentRecursive(this.comments, commentId);
                    }
                },
                // Helper: Recursive Find
                findComment(list, id) {
                    for (let comment of list) {
                        if (comment.id === id) return comment;
                        const found = this.findComment(comment.replies, id);
                        if (found) return found;
                    }
                    return null;
                },
                // Helper: Recursive Delete
                deleteCommentRecursive(list, id) {
                    const index = list.findIndex(c => c.id === id);
                    if (index !== -1) {
                        list.splice(index, 1);
                        return true;
                    }
                    for (let comment of list) {
                        if (this.deleteCommentRecursive(comment.replies, id)) return true;
                    }
                    return false;
                }
            }
        });

        // Component: Comment Input
        app.component('comment-input', {
            props: {
                placeholder: { type: String, default: 'Write a comment...' },
                buttonText: { type: String, default: 'Reply' }
            },
            emits: ['submit'],
            data() {
                return {
                    text: ''
                }
            },
            methods: {
                handleSubmit() {
                    if (this.text.trim()) {
                        this.$emit('submit', this.text);
                        this.text = '';
                    }
                }
            },
            template: `
                <div class="flex flex-col gap-2">
                    <textarea 
                        v-model="text" 
                        :placeholder="placeholder" 
                        class="w-full p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all bg-gray-50 focus:bg-white"
                        rows="3"
                    ></textarea>
                    <div class="flex justify-end">
                        <button 
                            @click="handleSubmit" 
                            :disabled="!text.trim()"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold text-sm hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                        >
                            <span>{{ buttonText }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </div>
            `
        });

        // Component: Comment Card
        app.component('comment-card', {
            props: {
                comment: { type: Object, required: true },
                depth: { type: Number, default: 0 }
            },
            emits: ['like', 'reply', 'delete'],
            data() {
                return {
                    showReplyInput: false
                }
            },
            methods: {
                onReplySubmit(text) {
                    this.$emit('reply', this.comment.id, text);
                    this.showReplyInput = false;
                }
            },
            template: `
                <div class="group transition-all duration-300">
                    <!-- Comment Container -->
                    <div class="flex gap-4 bg-white p-5 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow relative">
                        
                        <!-- Avatar -->
                        <div class="flex-shrink-0">
                            <img :src="comment.avatar || 'https://via.placeholder.com/40'" alt="Avatar" class="w-10 h-10 rounded-full bg-gray-200">
                        </div>

                        <!-- Content -->
                        <div class="flex-1 min-w-0">
                            <!-- Header -->
                            <div class="flex justify-between items-start mb-1">
                                <div class="flex items-center gap-2">
                                    <h3 class="font-bold text-gray-900">{{ comment.author }}</h3>
                                    <span class="text-xs text-gray-500">â€¢ {{ comment.timestamp }}</span>
                                </div>
                            </div>

                            <!-- Text -->
                            <p class="text-gray-700 mb-3 leading-relaxed break-words">{{ comment.text }}</p>

                            <!-- Actions -->
                            <div class="flex items-center gap-4 text-sm font-medium">
                                <!-- Like Button -->
                                <button 
                                    @click="$emit('like', comment.id)" 
                                    :class="['flex items-center gap-1 transition-colors', comment.liked ? 'text-red-500' : 'text-gray-500 hover:text-red-500']"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" :class="['h-5 w-5', comment.liked ? 'fill-current' : '']" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                    </svg>
                                    <span>{{ comment.likes }}</span>
                                </button>

                                <!-- Reply Button -->
                                <button 
                                    @click="showReplyInput = !showReplyInput" 
                                    class="flex items-center gap-1 text-gray-500 hover:text-blue-600 transition-colors"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                                    </svg>
                                    <span>Reply</span>
                                </button>

                                <!-- Delete Button -->
                                <button 
                                    @click="$emit('delete', comment.id)" 
                                    class="flex items-center gap-1 text-gray-400 hover:text-red-600 transition-colors ml-auto opacity-0 group-hover:opacity-100 focus:opacity-100"
                                    title="Delete comment"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Reply Input Area -->
                            <div v-if="showReplyInput" class="mt-4 animate-fade-in-down">
                                <comment-input 
                                    :placeholder="'Replying to ' + comment.author + '...'" 
                                    @submit="onReplySubmit">
                                </comment-input>
                            </div>
                        </div>
                    </div>

                    <!-- Nested Replies -->
                    <!-- Indentation applied via padding-left on container -->
                    <div v-if="comment.replies.length > 0" class="pl-6 md:pl-12 mt-3 space-y-3 border-l-2 border-gray-100 ml-5">
                        <comment-card
                            v-for="reply in comment.replies"
                            :key="reply.id"
                            :comment="reply"
                            :depth="depth + 1"
                            @like="$emit('like', $event)"
                            @reply="$emit('reply', $event)"
                            @delete="$emit('delete', $event)"
                        ></comment-card>
                    </div>
                </div>
            `
        });

        app.mount('#app');
    </script>
</body>
</html>